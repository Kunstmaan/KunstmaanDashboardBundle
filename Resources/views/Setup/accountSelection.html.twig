{% extends 'KunstmaanAdminBundle:Default:layout.html.twig' %}

{% block header %}{% endblock %}

{% block content %}
<form method="post" action="">
    <h2>{{ 'dashboard.ga.setup.title' | trans }}</h2>
    <h3>{{ 'dashboard.ga.setup.account.title' | trans }}</h3>

    <select id="accounts">
        <option data-id="">Select an account..</option>
    </select>

    <select id="properties">
        <option data-id="">Select a property..</option>
    </select>

    <select id="profiles">
        <option data-id="">Select a profile..</option>
    </select>

<br/>
    <button id="submit_save" class="btn btn-primary" type="submit" disabled>{{ 'form.save' | trans }}</button>
</form>

<input type="hidden" id="path_accounts" data-url="{{ path('DashBoardBundle_AJAX_accounts') }}" />
<input type="hidden" id="path_properties" data-url="{{ path('DashBoardBundle_AJAX_properties') }}" />
<input type="hidden" id="path_profiles" data-url="{{ path('DashBoardBundle_AJAX_profiles') }}" />
<input type="hidden" id="path_account_save" data-url="{{ path('DashBoardBundle_AJAX_account_save') }}" />
<input type="hidden" id="path_property_save" data-url="{{ path('DashBoardBundle_AJAX_property_save') }}" />
<input type="hidden" id="path_profile_save" data-url="{{ path('DashBoardBundle_AJAX_profile_save') }}" />











<script>

$(function () {

    $('#properties').css('display', 'none');
    $('#profiles').css('display', 'none');
    setAccountData();


    $("#accounts").change(function() {
        $("#properties").fadeOut();
        $("#profiles").fadeOut();
        $("#accounts option:selected").each(function() {
            var id = $(this).attr('data-id');
            var url = $('#path_account_save').attr('data-url');
            $.ajax({
                type: 'get',
                url: url,
                data: {'id' : id},
                success: function (data) {
                    setPropertyData();
                }
            });
        });
    });

    $("#properties").change(function() {
        $("#profiles").fadeOut();
        $("#properties option:selected").each(function() {
            var id = $(this).attr('data-id');
            var url = $('#path_property_save').attr('data-url');
            $.ajax({
                type: 'get',
                url: url,
                data: {'id' : id},
                success: function (data) {
                    setProfileData();
                }
            });
        });
    });

    $("#profiles").change(function() {
        $("#profiles option:selected").each(function() {
            var id = $(this).attr('data-id');
            var url = $('#path_profile_save').attr('data-url');
            $.ajax({
                type: 'get',
                url: url,
                data: {'id' : id},
                success: function (data) {
                    $('#submit_save').removeAttr('disabled');
                }
            });
        });
    });



    function setAccountData() {
        var url = $('#path_accounts').attr('data-url');

        $('#accounts').children().each(function (i) {
            if (i != 0) {
                $(this).remove();
            }
        })

        $.ajax({
            type: 'get',
            url: url,
            success: function (data) {
                for(var i = 0; i < data.length; i++) {
                    var option = $('<option>', { 'data-id': data[i].accountId, text: data[i].accountName});
                    $('#accounts').append(option);
                    $('#accounts').fadeIn();
                }
            }
        });
    }

    function setPropertyData() {
        var url = $('#path_properties').attr('data-url');

        $('#properties').children().each(function (i) {
            if (i != 0) {
                $(this).remove();
            }
        })

        $.ajax({
            type: 'get',
            url: url,
            success: function (data) {
                for(var i = 0; i < data.length; i++) {
                    var option = $('<option>', { 'data-id': data[i].propertyId, text: data[i].propertyName});
                    $('#properties').append(option);
                    $('#properties').fadeIn();
                }
            }
        });
    }

    function setProfileData() {
        var url = $('#path_profiles').attr('data-url');

        $('#profiles').children().each(function (i) {
            if (i != 0) {
                $(this).remove();
            }
        })

        $.ajax({
            type: 'get',
            url: url,
            success: function (data) {
                for(var i = 0; i < data.length; i++) {
                    var option = $('<option>', { 'data-id': data[i].profileId, text: data[i].profileName});
                    $('#profiles').append(option);
                    $('#profiles').fadeIn();
                }
            }
        });
    }

});

</script>


{% endblock %}
